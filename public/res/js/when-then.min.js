var when=function(){if(!(this instanceof when))return new when(arguments);var e=this;e.pending=Array.prototype.slice.call(arguments[0]);e.pending_length=e.pending.length;e.results={length:0};(function(){e.pass=function(){e.results[arguments[0]]=arguments[1];e.results.length++;if(e.results.length===e.pending_length)e.then.call(e,e.results)}})()};when.prototype={then:function(){this.then=arguments[0];while(this.pending[0]){this.pending.shift().call(this,this.pass)}}}