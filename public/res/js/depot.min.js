(function(e,t,n){"object"==typeof exports?module.exports=n():"function"==typeof define&&define.amd?define(n):t[e]=n()})("depot",this,function(){function e(e){return e&&JSON.parse(e)}function t(e,t){var n,r;if("function"==typeof e)n=e(t);else for(r in n=!0,e)n&=e[r]===t[r];return n}function n(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function r(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var i={save:function(e){var t;e[this.idAttribute]||(e[this.idAttribute]=n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n());t=e[this.idAttribute]+"";0>this.ids.indexOf(t)&&(this.ids.push(t),this.storageAdaptor.setItem(this.name,this.ids.join(",")));this.storageAdaptor.setItem(this.name+"-"+t,JSON.stringify(e));return e},update:function(e,t){"undefined"==typeof t&&(t=e,e=t[this.idAttribute]);var n=this.get(e);n&&(n=r(n,t),this.save(n));return n},updateAll:function(e){var t=this.all();t.forEach(function(t){t=r(t,e);this.save(t)},this);return t},find:function(n){var r,i,s=this.name,o=this;return!n?this.all():this.ids.reduce(function(u,l){i=e(o.storageAdaptor.getItem(s+"-"+l));(r=t(n,i))&&u.push(i);return u},[])},get:function(t){return e(this.storageAdaptor.getItem(this.name+"-"+t))},all:function(){var t,n=this,r=this.name;return this.ids.reduce(function(i,s){(t=n.storageAdaptor.getItem(r+"-"+s))&&i.push(e(t));return i},[])},destroy:function(t){var n;n=t[this.idAttribute]?t[this.idAttribute]:t;var r=this.name+"-"+n;t=e(this.storageAdaptor.getItem(r));this.storageAdaptor.removeItem(r);n=this.ids.indexOf(n);-1!=n&&this.ids.splice(n,1);this.storageAdaptor.setItem(this.name,this.ids.join(","));return t},destroyAll:function(n){for(var r,i,s=this.ids.length-1;0<=s;s--)if(r=this.ids[s],r=this.name+"-"+r,n){if(i=e(this.storageAdaptor.getItem(r)),i=t(n,i))this.storageAdaptor.removeItem(r),this.ids.splice(s,1)}else this.storageAdaptor.removeItem(r);n?this.storageAdaptor.setItem(this.name,this.ids.join(",")):(this.storageAdaptor.removeItem(this.name),this.ids=[])},size:function(){return this.ids.length}};return function(e,t){var n,s;t=r({idAttribute:"_id",storageAdaptor:localStorage},t);if(!t.storageAdaptor)throw Error("No storage adaptor was found");s=(n=t.storageAdaptor.getItem(e))&&n.split(",")||[];return Object.create(i,{name:{value:e},store:{value:n},ids:{value:s,writable:!0},idAttribute:{value:t.idAttribute},storageAdaptor:{value:t.storageAdaptor}})}})